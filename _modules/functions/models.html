<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>functions.models &mdash; HofstadterTools 1.0.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../_static/logo.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            HofstadterTools
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../overview.html#basic-install">Basic install</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../overview.html#using-pip">Using pip</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../overview.html#using-conda">Using conda</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../overview.html#advanced-install">Advanced install</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../overview.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#directory-structure">Directory Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#how-to-cite">How to Cite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#acknowledgments">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#contributing">Contributing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../theory.html">Theory</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../theory/model.html">Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../theory/band_structure.html">Band Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../theory/butterfly.html">Butterfly</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/band_structure.html">Band Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/butterfly.html">Butterfly</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery.html">Gallery</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../gallery.html#square-lattice">Square Lattice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gallery.html#triangular-lattice">Triangular Lattice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gallery.html#bravais-lattice">Bravais Lattice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gallery.html#honeycomb-lattice">Honeycomb Lattice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gallery.html#kagome-lattice">Kagome Lattice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting.html#general-questions">General Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting.html#band-structure-questions">Band Structure Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting.html#butterfly-questions">Butterfly Questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/functions.html">functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/functions.arguments.html">functions.arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.arguments.parse_input_arguments.html">functions.arguments.parse_input_arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.arguments.parse_input_arguments.html#functions.arguments.parse_input_arguments"><code class="docutils literal notranslate"><span class="pre">parse_input_arguments()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/functions.band_structure.html">functions.band_structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.band_structure.U.html">functions.band_structure.U</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.band_structure.U.html#functions.band_structure.U"><code class="docutils literal notranslate"><span class="pre">U()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.band_structure.berry_curv.html">functions.band_structure.berry_curv</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.band_structure.berry_curv.html#functions.band_structure.berry_curv"><code class="docutils literal notranslate"><span class="pre">berry_curv()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.band_structure.geom_tensor.html">functions.band_structure.geom_tensor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.band_structure.geom_tensor.html#functions.band_structure.geom_tensor"><code class="docutils literal notranslate"><span class="pre">geom_tensor()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.band_structure.wilson_loop.html">functions.band_structure.wilson_loop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.band_structure.wilson_loop.html#functions.band_structure.wilson_loop"><code class="docutils literal notranslate"><span class="pre">wilson_loop()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/functions.butterfly.html">functions.butterfly</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.butterfly.chern.html">functions.butterfly.chern</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.butterfly.chern.html#functions.butterfly.chern"><code class="docutils literal notranslate"><span class="pre">chern()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/functions.models.html">functions.models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.models.BasicHoneycombHamiltonian.html">functions.models.BasicHoneycombHamiltonian</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.models.BasicHoneycombHamiltonian.html#functions.models.BasicHoneycombHamiltonian"><code class="docutils literal notranslate"><span class="pre">BasicHoneycombHamiltonian()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.models.BasicKagomeHamiltonian.html">functions.models.BasicKagomeHamiltonian</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.models.BasicKagomeHamiltonian.html#functions.models.BasicKagomeHamiltonian"><code class="docutils literal notranslate"><span class="pre">BasicKagomeHamiltonian()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.models.BasicSquareHamiltonian.html">functions.models.BasicSquareHamiltonian</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.models.BasicSquareHamiltonian.html#functions.models.BasicSquareHamiltonian"><code class="docutils literal notranslate"><span class="pre">BasicSquareHamiltonian()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.models.BasicTriangularHamiltonian.html">functions.models.BasicTriangularHamiltonian</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.models.BasicTriangularHamiltonian.html#functions.models.BasicTriangularHamiltonian"><code class="docutils literal notranslate"><span class="pre">BasicTriangularHamiltonian()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.models.Hamiltonian.html">functions.models.Hamiltonian</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.models.Hamiltonian.html#functions.models.Hamiltonian"><code class="docutils literal notranslate"><span class="pre">Hamiltonian()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.models.diag_func.html">functions.models.diag_func</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.models.diag_func.html#functions.models.diag_func"><code class="docutils literal notranslate"><span class="pre">diag_func()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.models.nearest_neighbor_finder.html">functions.models.nearest_neighbor_finder</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.models.nearest_neighbor_finder.html#functions.models.nearest_neighbor_finder"><code class="docutils literal notranslate"><span class="pre">nearest_neighbor_finder()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.models.nearest_neighbor_sorter.html">functions.models.nearest_neighbor_sorter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.models.nearest_neighbor_sorter.html#functions.models.nearest_neighbor_sorter"><code class="docutils literal notranslate"><span class="pre">nearest_neighbor_sorter()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.models.peierls_factor.html">functions.models.peierls_factor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.models.peierls_factor.html#functions.models.peierls_factor"><code class="docutils literal notranslate"><span class="pre">peierls_factor()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.models.reciprocal_vectors.html">functions.models.reciprocal_vectors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.models.reciprocal_vectors.html#functions.models.reciprocal_vectors"><code class="docutils literal notranslate"><span class="pre">reciprocal_vectors()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/functions.plotting.html">functions.plotting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.plotting.band_structure.html">functions.plotting.band_structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.plotting.band_structure.html#functions.plotting.band_structure"><code class="docutils literal notranslate"><span class="pre">band_structure()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.plotting.butterfly.html">functions.plotting.butterfly</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.plotting.butterfly.html#functions.plotting.butterfly"><code class="docutils literal notranslate"><span class="pre">butterfly()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/functions.utility.html">functions.utility</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.utility.create_filename.html">functions.utility.create_filename</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.utility.create_filename.html#functions.utility.create_filename"><code class="docutils literal notranslate"><span class="pre">create_filename()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.utility.load_data.html">functions.utility.load_data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.utility.load_data.html#functions.utility.load_data"><code class="docutils literal notranslate"><span class="pre">load_data()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.utility.read_t_from_file.html">functions.utility.read_t_from_file</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.utility.read_t_from_file.html#functions.utility.read_t_from_file"><code class="docutils literal notranslate"><span class="pre">read_t_from_file()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.utility.save_data.html">functions.utility.save_data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.utility.save_data.html#functions.utility.save_data"><code class="docutils literal notranslate"><span class="pre">save_data()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/functions.utility.Logger.html">functions.utility.Logger</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/functions.utility.Logger.html#functions.utility.Logger"><code class="docutils literal notranslate"><span class="pre">Logger</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/models.html">models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/models.hofstadter.html">models.hofstadter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/models.hofstadter.Hofstadter.html">models.hofstadter.Hofstadter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/models.hofstadter.Hofstadter.html#models.hofstadter.Hofstadter"><code class="docutils literal notranslate"><span class="pre">Hofstadter</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">HofstadterTools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">functions.models</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for functions.models</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Functions for the model classes.&quot;&quot;&quot;</span>

<span class="c1"># --- external imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">axes3d</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>


<div class="viewcode-block" id="reciprocal_vectors"><a class="viewcode-back" href="../../_autosummary/functions.models.reciprocal_vectors.html#functions.models.reciprocal_vectors">[docs]</a><span class="k">def</span> <span class="nf">reciprocal_vectors</span><span class="p">(</span><span class="n">avec</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Finds the reciprocal lattice vectors in 2D.</span>

<span class="sd">    .. math::</span>
<span class="sd">        \begin{pmatrix}</span>
<span class="sd">        b_{1x} &amp; b_{2x} \\</span>
<span class="sd">        b_{1y} &amp; b_{2y}</span>
<span class="sd">        \end{pmatrix} =</span>
<span class="sd">        \frac{2\\\pi}{a_{1x}a_{2y} - a_{1y}a_{2x}}</span>
<span class="sd">        \begin{pmatrix}</span>
<span class="sd">        a_{2y} &amp; -a_{1y} \\</span>
<span class="sd">        -a_{2x} &amp; a_{1x}</span>
<span class="sd">        \end{pmatrix}</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    avec: ndarray</span>
<span class="sd">        The array of real-space lattice vectors.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bvec: ndarray</span>
<span class="sd">        The array of reciprocal-space lattice vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">avec</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Reciprocal lattice vector function only works in 2D.&quot;</span><span class="p">)</span>

    <span class="n">a1</span> <span class="o">=</span> <span class="n">avec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">avec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">rec_factor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">a2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">rec_factor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">rec_factor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">a1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a1</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">bvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">bvec</span></div>


<div class="viewcode-block" id="nearest_neighbor_finder"><a class="viewcode-back" href="../../_autosummary/functions.models.nearest_neighbor_finder.html#functions.models.nearest_neighbor_finder">[docs]</a><span class="k">def</span> <span class="nf">nearest_neighbor_finder</span><span class="p">(</span><span class="n">avec</span><span class="p">,</span> <span class="n">abasisvec</span><span class="p">,</span> <span class="n">t_list</span><span class="p">,</span> <span class="n">x_init</span><span class="p">,</span> <span class="n">y_init</span><span class="p">,</span> <span class="n">basis_init</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the relevant nearest neighbors for a given lattice.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    avec: ndarray</span>
<span class="sd">        The lattice vectors.</span>
<span class="sd">    abasisvec: ndarray</span>
<span class="sd">        The basis vectors.</span>
<span class="sd">    t_list: list</span>
<span class="sd">        The list of hopping amplitudes in order of ascending NN.</span>
<span class="sd">    x_init: float</span>
<span class="sd">        The initial x-coordinate.</span>
<span class="sd">    y_init: float</span>
<span class="sd">        The initial y-coordinate.</span>
<span class="sd">    basis_init: int</span>
<span class="sd">        The initial sublattice index.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data: ndarray</span>
<span class="sd">        The array of relevant nearest neighbors.</span>
<span class="sd">    bases: list</span>
<span class="sd">        The list of unique sublattice indices.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># --- Create list of NN to consider from t_list</span>
    <span class="n">numb_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">numb_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># --- Create grid of basis vectors from [-numb_t_max, numb_t_max]</span>
    <span class="n">abasisvec</span> <span class="o">=</span> <span class="p">[</span><span class="n">abasisvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">abasisvec</span><span class="p">[</span><span class="n">basis_init</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">abasisvec</span><span class="p">))]</span>  <span class="c1"># shift basis</span>
    <span class="n">vectors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vectors_unit</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">numb_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">numb_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">numb_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">numb_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">r_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
            <span class="n">vectors_unit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_unit</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">r_unit</span><span class="p">,</span> <span class="n">avec</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">abasisvec</span><span class="p">):</span>
                <span class="n">vectors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">r</span><span class="o">+</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">basis_init</span><span class="p">,</span> <span class="n">idx</span><span class="p">])</span>  <span class="c1"># add basis index</span>

    <span class="c1"># --- Define data array with info on each vector</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">vectors</span><span class="p">),</span> <span class="mi">13</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vectors</span><span class="p">):</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># r (round so that we can use it for comparison)</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># phi</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_init</span>  <span class="c1"># x_init</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_init</span>  <span class="c1"># y_init</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_init</span> <span class="o">/</span> <span class="n">avec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># y_init / a2_y</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># dx</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># dy</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">avec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># dy / a2_y</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># dI</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># dJ</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># sub_init</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># sub_final</span>

    <span class="c1"># --- Extract the NN groups (filter data based on radius)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>  <span class="c1"># sort by increasing r</span>
    <span class="c1"># delete the first r=0 row</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">radii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])))</span>
    <span class="c1"># label the NN group</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">radii</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>  <span class="c1"># NN group</span>
    <span class="n">select_radii</span> <span class="o">=</span> <span class="p">[</span><span class="n">radii</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numb_list</span><span class="p">]</span>
    <span class="c1"># delete rows with other radii</span>
    <span class="n">rows_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">select_radii</span><span class="p">:</span>
            <span class="n">rows_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rows_to_delete</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># --- Extract bases set</span>
    <span class="n">bases</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">bases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
        <span class="n">bases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
    <span class="n">bases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">bases</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">bases</span></div>


<div class="viewcode-block" id="nearest_neighbor_sorter"><a class="viewcode-back" href="../../_autosummary/functions.models.nearest_neighbor_sorter.html#functions.models.nearest_neighbor_sorter">[docs]</a><span class="k">def</span> <span class="nf">nearest_neighbor_sorter</span><span class="p">(</span><span class="n">data_array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sorts the relevant nearest neighbors array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data_array: ndarray</span>
<span class="sd">        The array of relevant nearest neighbors.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    grouped_paths: ndarray</span>
<span class="sd">        The array of relevant nearest neighbors grouped by dJ.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># count the number of dJ</span>
    <span class="n">dJ_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_array</span><span class="p">):</span>
        <span class="n">dJ_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
    <span class="n">dJ_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dJ_list</span><span class="p">)))</span>
    <span class="n">numb_dJ</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dJ_list</span><span class="p">)</span>

    <span class="c1"># group paths by dJ</span>
    <span class="n">grouped_paths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numb_dJ</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numb_dJ</span><span class="p">):</span>
        <span class="n">grouped_paths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dJval</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dJ_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_array</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">==</span> <span class="n">dJval</span><span class="p">:</span>
                <span class="n">grouped_paths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">grouped_paths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dJval</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">grouped_paths</span></div>


<div class="viewcode-block" id="peierls_factor"><a class="viewcode-back" href="../../_autosummary/functions.models.peierls_factor.html#functions.models.peierls_factor">[docs]</a><span class="k">def</span> <span class="nf">peierls_factor</span><span class="p">(</span><span class="n">nphi</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y_cart</span><span class="p">,</span> <span class="n">dy_cart</span><span class="p">,</span> <span class="n">A_UC</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;The Peierls factor.</span>

<span class="sd">    The Peierls factor in Landau gauge :math:`\\\mathbf{A}=-By\hat{\\\mathbf{e}}_x` is given by</span>

<span class="sd">    .. math::</span>
<span class="sd">        e^{\\\mathrm{i}\theta_{ij}} = \exp\left[ -\frac{2\pi\\\mathrm{i}n_\phi}{A} \Delta X \left( Y_i + \frac{\Delta Y}{2} \right) \right],</span>

<span class="sd">    where :math:`\theta_{ij}` is the Peierls phase from site :math:`i=(X_i, Y_i)`. to :math:`j=(X_j, Y_j)`, :math:`\Delta X = X_j - X_i`, :math:`\Delta Y = Y_j - Y_i`, :math:`n_\phi` is the flux density, and :math:`A` is the area factor to make the expression dimensionless. :cite:`Peierls33`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nphi: float</span>
<span class="sd">        The flux density.</span>
<span class="sd">    dx: float</span>
<span class="sd">        The change in x-coordinates.</span>
<span class="sd">    y_cart: int</span>
<span class="sd">        The initial y-coordinate in units of a2[1].</span>
<span class="sd">    dy_cart: int</span>
<span class="sd">        The change in y-coordinates in units of a2[1].</span>
<span class="sd">    A_UC: float</span>
<span class="sd">        The unit cell area in units of a2 (possibly scaled by a periodicity factor).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    factor: complex</span>
<span class="sd">        The Peierls factor.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">phase</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">nphi</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_cart</span> <span class="o">+</span> <span class="n">dy_cart</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">A_UC</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">factor</span></div>


<div class="viewcode-block" id="diag_func"><a class="viewcode-back" href="../../_autosummary/functions.models.diag_func.html#functions.models.diag_func">[docs]</a><span class="k">def</span> <span class="nf">diag_func</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">p_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">,</span> <span class="n">A_UC_val</span><span class="p">,</span> <span class="n">vec_group</span><span class="p">,</span> <span class="n">k_val</span><span class="p">,</span> <span class="n">dJ_val</span><span class="p">,</span> <span class="n">J_idx_val</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;The diagonal function.</span>

<span class="sd">    The function that populates the diagonals of the Harper matrix is given by</span>

<span class="sd">    .. math::</span>
<span class="sd">        \Lambda_{l, n} = - \sum_\kappa \sum_{\langle ij \rangle_{\kappa}^l} t_\kappa e^{\\\mathrm{i}\theta_{ij}} e^{\\\mathrm{i}\\\mathbf{k}\cdot\\\mathbf{r}},</span>

<span class="sd">    where :math:`\langle \dots \rangle^l_\kappa` denotes the subset of :math:`\kappa`-th nearest neighbors with a net :math:`y` unit cell displacement of :math:`l`, :math:`\theta_{ij}` is the Peierls phase, :math:`\\\mathbf{k}` is the momentum vector, and :math:`\\\mathbf{r}` is the displacement vector.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t_val: list</span>
<span class="sd">        The list of hopping amplitudes in order of ascending NN.</span>
<span class="sd">    p_val: int</span>
<span class="sd">        The numerator of the flux density.</span>
<span class="sd">    q_val: int</span>
<span class="sd">        The denominator of the flux density.</span>
<span class="sd">    A_UC_val: float</span>
<span class="sd">        The unit cell area in units of a2 (possibly scaled by a periodicity factor).</span>
<span class="sd">    vec_group: ndarray</span>
<span class="sd">        The array of relevant nearest neighbors grouped by dJ.</span>
<span class="sd">    k_val: ndarray</span>
<span class="sd">        The momentum vector.</span>
<span class="sd">    dJ_val: int</span>
<span class="sd">        The y-displacement in terms of unit cells.</span>
<span class="sd">    J_idx_val: int</span>
<span class="sd">        The y-position in terms of unit cells.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    term: complex</span>
<span class="sd">        The diagonal term.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nphi</span> <span class="o">=</span> <span class="n">p_val</span><span class="o">/</span><span class="n">q_val</span>
    <span class="n">term</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vec_group</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">dJ_val</span><span class="p">:</span>  <span class="c1"># extract rows with appropriate dJ</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">val</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>  <span class="c1"># for each vector in path group</span>
                <span class="n">NN_group</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val2</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
                <span class="n">term</span> <span class="o">+=</span> <span class="o">-</span> <span class="n">t_val</span><span class="p">[</span><span class="n">NN_group</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">peierls_factor</span><span class="p">(</span><span class="n">nphi</span><span class="p">,</span> <span class="n">val2</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">J_idx_val</span> <span class="o">+</span> <span class="n">val2</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">val2</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">A_UC_val</span><span class="p">)</span>
                                                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">val2</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">val2</span><span class="p">[</span><span class="mi">6</span><span class="p">]]),</span> <span class="n">k_val</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">term</span></div>


<div class="viewcode-block" id="Hamiltonian"><a class="viewcode-back" href="../../_autosummary/functions.models.Hamiltonian.html#functions.models.Hamiltonian">[docs]</a><span class="k">def</span> <span class="nf">Hamiltonian</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">A_UC</span><span class="p">,</span> <span class="n">vec_group_matrix</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;The generalized Hofstadter Hamiltonian.</span>

<span class="sd">    The generalized Hofstadter Hamiltonian is given by the :math:`N_b\times N_b` block matrix</span>

<span class="sd">    .. math::</span>
<span class="sd">        H = \begin{pmatrix}</span>
<span class="sd">        H^{00} &amp; H^{01} &amp; \dots \\</span>
<span class="sd">        H^{10} &amp; H^{11} &amp; \dots \\</span>
<span class="sd">        \vdots &amp; \vdots &amp; \ddots</span>
<span class="sd">        \end{pmatrix},</span>

<span class="sd">    where :math:`N_b` is the number of sites in the basis. Each submatrix :math:`H^{\alpha\beta}` has dimensions :math:`q\times q` and represents the Harper equation for hoppings from the :math:`\alpha` to the :math:`\beta` sublatttice, such that</span>

<span class="sd">    .. math::</span>
<span class="sd">        H = \begin{pmatrix}</span>
<span class="sd">        \Lambda_{0,0} &amp; \Lambda_{0,1} &amp; \dots \\</span>
<span class="sd">        \Lambda_{1,0} &amp; \Lambda_{1,1} &amp; \dots \\</span>
<span class="sd">        \vdots &amp; \vdots &amp; \ddots</span>
<span class="sd">        \end{pmatrix} +</span>
<span class="sd">        \begin{pmatrix}</span>
<span class="sd">        \ddots &amp; \Lambda_{0, q-1}^* &amp; \Lambda_{0, q}^* \\</span>
<span class="sd">        \Lambda_{q-1, 0} &amp; \ddots &amp; \Lambda_{1, q}^* \\</span>
<span class="sd">        \Lambda_{q, 0} &amp; \Lambda_{q, 1} &amp; \ddots</span>
<span class="sd">        \end{pmatrix},</span>

<span class="sd">    where :math:`\Lambda_{l, n}` is the diagonal function, and we have dropped the sublattice superscripts for readability. Note that we only populate the first matrix with unique hoppings in the positive J direction. If there are inter-unit-cell hoppings that are related by Hermitian conjugation in the same Harper equation, then the lower triangular matrix will simply be the conjugate of the upper triangular matrix. The second matrix represents rolled over boundary terms.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t: list</span>
<span class="sd">        The list of hopping amplitudes in order of ascending NN.</span>
<span class="sd">    p: int</span>
<span class="sd">        The numerator of the flux density.</span>
<span class="sd">    q: int</span>
<span class="sd">        The denominator of the flux density.</span>
<span class="sd">    A_UC: float</span>
<span class="sd">        The unit cell area in units of a2 (possibly scaled by a periodicity factor).</span>
<span class="sd">    vec_group_matrix: ndarray</span>
<span class="sd">        The matrix of grouped nearest neighbor arrays.</span>
<span class="sd">    k: ndarray</span>
<span class="sd">        The momentum vector.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Hamiltonian: ndarray</span>
<span class="sd">        The Hofstadter Hamiltonian matrix of dimension :math:`N_b q \times N_b q`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec_group_matrix</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec_group_matrix</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">Ham_matrix</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="p">):</span>
        <span class="n">Ham_row</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">):</span>
            <span class="n">Hamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

            <span class="n">dJ_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">vec_group_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                <span class="n">dJ_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">HC_flag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">k1</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dJ_list</span><span class="p">):</span>  <span class="c1"># remove negative unit cell hoppings (for H.c. cases)</span>
                <span class="k">for</span> <span class="n">k2</span><span class="p">,</span> <span class="n">val2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dJ_list</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="o">-</span><span class="n">val2</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">HC_flag</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">val2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">del</span> <span class="n">dJ_list</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">del</span> <span class="n">dJ_list</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">dJ</span> <span class="ow">in</span> <span class="n">dJ_list</span><span class="p">:</span>
                <span class="c1"># upper_diag_array</span>
                <span class="n">diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">diag_func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">A_UC</span><span class="p">,</span> <span class="n">vec_group_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">k</span><span class="p">,</span> <span class="n">dJ</span><span class="p">,</span> <span class="n">J_idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">J_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">)])</span>
                <span class="n">Hamiltonian</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">diag_array</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dJ</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dJ</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                <span class="c1"># lower_diag_array</span>
                <span class="k">if</span> <span class="n">HC_flag</span> <span class="ow">and</span> <span class="n">dJ</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Hamiltonian</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">diag_array</span><span class="p">)),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dJ</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">Ham_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Hamiltonian</span><span class="p">)</span>
        <span class="n">Ham_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ham_row</span><span class="p">)</span>
    <span class="n">Hamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="n">Ham_matrix</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Hamiltonian</span></div>


<div class="viewcode-block" id="BasicSquareHamiltonian"><a class="viewcode-back" href="../../_autosummary/functions.models.BasicSquareHamiltonian.html#functions.models.BasicSquareHamiltonian">[docs]</a><span class="k">def</span> <span class="nf">BasicSquareHamiltonian</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;The basic square lattice Hofstadter Hamiltonian.</span>

<span class="sd">    The Hofstadter Hamiltonian for the square lattice with nearest-neighbor hopping.</span>

<span class="sd">    .. note::</span>

<span class="sd">        We have hardcoded this Hamiltonian because it is commonly used and this function is faster than calling the generic Hamiltonian method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t: list</span>
<span class="sd">        The list of hopping amplitudes in order of ascending NN.</span>
<span class="sd">    p: int</span>
<span class="sd">        The numerator of the flux density.</span>
<span class="sd">    q: int</span>
<span class="sd">        The denominator of the flux density.</span>
<span class="sd">    k: ndarray</span>
<span class="sd">        The momentum vector.</span>
<span class="sd">    period: int</span>
<span class="sd">        The factor by which to divide A_UC in the flux density.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Hamiltonian: ndarray</span>
<span class="sd">        The Hofstadter Hamiltonian matrix of dimension :math:`q \times q`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Hamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="n">nphi</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="n">q</span>

    <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">B_plus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="n">diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">)])</span>
    <span class="n">Hamiltonian</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">diag_array</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">upper_diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">B_plus</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">)])</span>
    <span class="n">Hamiltonian</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">Hamiltonian</span> <span class="o">=</span> <span class="n">Hamiltonian</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Hamiltonian</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">Hamiltonian</span></div>


<div class="viewcode-block" id="BasicTriangularHamiltonian"><a class="viewcode-back" href="../../_autosummary/functions.models.BasicTriangularHamiltonian.html#functions.models.BasicTriangularHamiltonian">[docs]</a><span class="k">def</span> <span class="nf">BasicTriangularHamiltonian</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;The basic triangular lattice Hofstadter Hamiltonian.</span>

<span class="sd">    The Hofstadter Hamiltonian for the triangular lattice with nearest-neighbor hopping.</span>

<span class="sd">    .. note::</span>

<span class="sd">        We have hardcoded this Hamiltonian because it is commonly used and this function is faster than calling the generic Hamiltonian method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t: list</span>
<span class="sd">        The list of hopping amplitudes in order of ascending NN.</span>
<span class="sd">    p: int</span>
<span class="sd">        The numerator of the flux density.</span>
<span class="sd">    q: int</span>
<span class="sd">        The denominator of the flux density.</span>
<span class="sd">    k: ndarray</span>
<span class="sd">        The momentum vector.</span>
<span class="sd">    period: int</span>
<span class="sd">        The factor by which to divide A_UC in the flux density.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Hamiltonian: ndarray</span>
<span class="sd">        The Hofstadter Hamiltonian matrix of dimension :math:`q \times q`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Hamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="n">nphi</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="n">q</span>

    <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">B_plus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                 <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="n">diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">)])</span>
    <span class="n">Hamiltonian</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">diag_array</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">upper_diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">B_plus</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">)])</span>
    <span class="n">Hamiltonian</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">Hamiltonian</span> <span class="o">=</span> <span class="n">Hamiltonian</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Hamiltonian</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">Hamiltonian</span></div>


<div class="viewcode-block" id="BasicHoneycombHamiltonian"><a class="viewcode-back" href="../../_autosummary/functions.models.BasicHoneycombHamiltonian.html#functions.models.BasicHoneycombHamiltonian">[docs]</a><span class="k">def</span> <span class="nf">BasicHoneycombHamiltonian</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;The basic honeycomb lattice Hofstadter Hamiltonian.</span>

<span class="sd">    The Hofstadter Hamiltonian for the honeycomb lattice with nearest-neighbor hopping.</span>

<span class="sd">    .. note::</span>

<span class="sd">        We have hardcoded this Hamiltonian because it is commonly used and this function is faster than calling the generic Hamiltonian method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t: list</span>
<span class="sd">        The list of hopping amplitudes in order of ascending NN.</span>
<span class="sd">    p: int</span>
<span class="sd">        The numerator of the flux density.</span>
<span class="sd">    q: int</span>
<span class="sd">        The denominator of the flux density.</span>
<span class="sd">    k: ndarray</span>
<span class="sd">        The momentum vector.</span>
<span class="sd">    period: int</span>
<span class="sd">        The factor by which to divide A_UC in the flux density.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Hamiltonian: ndarray</span>
<span class="sd">        The Hofstadter Hamiltonian matrix of dimension :math:`2q \times 2q`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">AB_block_func</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">p_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
        <span class="n">ham</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="n">nphi</span> <span class="o">=</span> <span class="n">p_val</span> <span class="o">/</span> <span class="n">q_val</span>

        <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">t_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="o">+</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">6</span><span class="p">))</span>
                     <span class="o">-</span><span class="n">t_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">6</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">def</span> <span class="nf">B_minus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">upper_diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">upper_diag_array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">B_minus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ham</span>

    <span class="k">def</span> <span class="nf">BA_block_func</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">p_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
        <span class="n">ham</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="n">nphi</span> <span class="o">=</span> <span class="n">p_val</span> <span class="o">/</span> <span class="n">q_val</span>

        <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">t_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="o">+</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">6</span><span class="p">))</span>
                     <span class="o">-</span><span class="n">t_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">6</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">def</span> <span class="nf">B_plus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">upper_diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">upper_diag_array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">B_plus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ham</span>

    <span class="n">AA_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
    <span class="n">AB_block</span> <span class="o">=</span> <span class="n">AB_block_func</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">BA_block</span> <span class="o">=</span> <span class="n">BA_block_func</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">BB_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AA_block</span><span class="p">,</span> <span class="n">AB_block</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">BA_block</span><span class="p">,</span> <span class="n">BB_block</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Hamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">upper</span><span class="p">,</span> <span class="n">lower</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Hamiltonian</span></div>


<div class="viewcode-block" id="BasicKagomeHamiltonian"><a class="viewcode-back" href="../../_autosummary/functions.models.BasicKagomeHamiltonian.html#functions.models.BasicKagomeHamiltonian">[docs]</a><span class="k">def</span> <span class="nf">BasicKagomeHamiltonian</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;The basic kagome lattice Hofstadter Hamiltonian.</span>

<span class="sd">    The Hofstadter Hamiltonian for the kagome lattice with nearest-neighbor hopping.</span>

<span class="sd">    .. note::</span>

<span class="sd">        We have hardcoded this Hamiltonian because it is commonly used and this function is faster than calling the generic Hamiltonian method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t: list</span>
<span class="sd">        The list of hopping amplitudes in order of ascending NN.</span>
<span class="sd">    p: int</span>
<span class="sd">        The numerator of the flux density.</span>
<span class="sd">    q: int</span>
<span class="sd">        The denominator of the flux density.</span>
<span class="sd">    k: ndarray</span>
<span class="sd">        The momentum vector.</span>
<span class="sd">    period: int</span>
<span class="sd">        The factor by which to divide A_UC in the flux density.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Hamiltonian: ndarray</span>
<span class="sd">        The Hofstadter Hamiltonian matrix of dimension :math:`3q \times 3q`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">AB_block_func</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">p_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
        <span class="n">ham</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="n">nphi</span> <span class="o">=</span> <span class="n">p_val</span> <span class="o">/</span> <span class="n">q_val</span>

        <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                     <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="n">m_val</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">upper_diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ham</span>

    <span class="k">def</span> <span class="nf">AC_block_func</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">p_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
        <span class="n">ham</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="n">nphi</span> <span class="o">=</span> <span class="n">p_val</span> <span class="o">/</span> <span class="n">q_val</span>

        <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">def</span> <span class="nf">B_minus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">upper_diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">upper_diag_array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">B_minus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ham</span>

    <span class="k">def</span> <span class="nf">BA_block_func</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">p_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
        <span class="n">ham</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="n">nphi</span> <span class="o">=</span> <span class="n">p_val</span> <span class="o">/</span> <span class="n">q_val</span>

        <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                     <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="n">m_val</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">upper_diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ham</span>

    <span class="k">def</span> <span class="nf">BC_block_func</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">p_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
        <span class="n">ham</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="n">nphi</span> <span class="o">=</span> <span class="n">p_val</span> <span class="o">/</span> <span class="n">q_val</span>

        <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">def</span> <span class="nf">B_minus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="o">+</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">upper_diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">upper_diag_array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">B_minus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ham</span>

    <span class="k">def</span> <span class="nf">CA_block_func</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">p_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
        <span class="n">ham</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="n">nphi</span> <span class="o">=</span> <span class="n">p_val</span> <span class="o">/</span> <span class="n">q_val</span>

        <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">def</span> <span class="nf">B_plus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">upper_diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">upper_diag_array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">B_plus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ham</span>

    <span class="k">def</span> <span class="nf">CB_block_func</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">p_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
        <span class="n">ham</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q_val</span><span class="p">,</span> <span class="n">q_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="n">nphi</span> <span class="o">=</span> <span class="n">p_val</span> <span class="o">/</span> <span class="n">q_val</span>

        <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">def</span> <span class="nf">B_plus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi_val</span><span class="p">,</span> <span class="n">m_val</span><span class="p">,</span> <span class="n">k_val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">t_val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">period</span><span class="o">*</span><span class="n">nphi_val</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">m_val</span> <span class="o">+</span> <span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">k_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">k_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">upper_diag_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">upper_diag_array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">B_plus</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q_val</span><span class="p">)])</span>
        <span class="n">ham</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag_array2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ham</span>

    <span class="n">AA_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
    <span class="n">AB_block</span> <span class="o">=</span> <span class="n">AB_block_func</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">AC_block</span> <span class="o">=</span> <span class="n">AC_block_func</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">BA_block</span> <span class="o">=</span> <span class="n">BA_block_func</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">BB_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
    <span class="n">BC_block</span> <span class="o">=</span> <span class="n">BC_block_func</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">CA_block</span> <span class="o">=</span> <span class="n">CA_block_func</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">CB_block</span> <span class="o">=</span> <span class="n">CB_block_func</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">CC_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AA_block</span><span class="p">,</span> <span class="n">AB_block</span><span class="p">,</span> <span class="n">AC_block</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">BA_block</span><span class="p">,</span> <span class="n">BB_block</span><span class="p">,</span> <span class="n">BC_block</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">CA_block</span><span class="p">,</span> <span class="n">CB_block</span><span class="p">,</span> <span class="n">CC_block</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Hamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">upper</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">lower</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Hamiltonian</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">]</span>

    <span class="n">vec_group</span> <span class="o">=</span> <span class="n">nearest_neighbor_finder</span><span class="p">(</span><span class="s2">&quot;square&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">vec_group</span><span class="p">)</span>

    <span class="c1">###</span>

    <span class="n">num_bands</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">101</span>

    <span class="n">b1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="n">num_bands</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">bvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">))</span>

    <span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_bands</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">))</span>  <span class="c1"># real</span>
    <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_bands</span><span class="p">,</span> <span class="n">num_bands</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>  <span class="c1"># complex</span>
    <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx_x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
            <span class="n">frac_kx</span> <span class="o">=</span> <span class="n">idx_x</span> <span class="o">/</span> <span class="p">(</span><span class="n">num_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx_y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
                <span class="n">frac_ky</span> <span class="o">=</span> <span class="n">idx_y</span> <span class="o">/</span> <span class="p">(</span><span class="n">num_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">frac_kx</span><span class="p">,</span> <span class="n">frac_ky</span><span class="p">]),</span> <span class="n">bvec</span><span class="p">)</span>
                <span class="c1"># print(&quot;k = &quot;, k)</span>
                <span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">Hamiltonian</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_bands</span><span class="p">,</span> <span class="n">vec_group</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">eigvals</span><span class="p">)</span>
                <span class="n">eigenvalues</span><span class="p">[</span><span class="n">band</span><span class="p">,</span> <span class="n">idx_x</span><span class="p">,</span> <span class="n">idx_y</span><span class="p">]</span> <span class="o">=</span> <span class="n">eigvals</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">band</span><span class="p">]]</span>
                <span class="n">eigenvectors</span><span class="p">[:,</span> <span class="n">band</span><span class="p">,</span> <span class="n">idx_x</span><span class="p">,</span> <span class="n">idx_y</span><span class="p">]</span> <span class="o">=</span> <span class="n">eigvecs</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">band</span><span class="p">]]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">idx_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">idx_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">idx_x</span><span class="p">,</span> <span class="n">idx_y</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">eigenvalues</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_1/|</span><span class="se">\\</span><span class="s1">mathbf</span><span class="si">{b}</span><span class="s1">_1|$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_2/|</span><span class="se">\\</span><span class="s1">mathbf</span><span class="si">{b}</span><span class="s1">_2|$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;$E$&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">tick_number</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;$0$&quot;</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="n">num_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;$1$&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">num_samples</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="si">:</span><span class="s2">.1g</span><span class="si">}</span><span class="s2">$&quot;</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">normalize</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">normalize</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Bartholomew Andrews.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>